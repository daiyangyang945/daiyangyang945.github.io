require=function t(e,i,s){function o(l,n){if(!i[l]){if(!e[l]){var h="function"==typeof require&&require;if(!n&&h)return h(l,!0);if(c)return c(l,!0);var r=new Error("Cannot find module '"+l+"'");throw r.code="MODULE_NOT_FOUND",r}var a=i[l]={exports:{}};e[l][0].call(a.exports,function(t){var i=e[l][1][t];return o(i?i:t)},a,a.exports,t,e,i,s)}return i[l].exports}for(var c="function"==typeof require&&require,l=0;l<s.length;l++)o(s[l]);return o}({CCMath:[function(t,e,i){(function(t){"use strict";cc._RFpush(e,"71bd79kjDBLxJyB6GiGH/Pz","CCMath");var i={};t.ccy=i,cc._RFpop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],CellModel:[function(t,e,i){(function(t){"use strict";function i(){this.type=null,this.status=CELL_STATUS.COMMON,this.x=1,this.y=1,this.startX=1,this.startY=1,this.cmd=[],this.isDeath=!1,this.objecCount=Math.floor(1e3*Math.random())}cc._RFpush(e,"dae88GCevBMaK7lQqhume8G","CellModel"),i.prototype.init=function(t){this.type=t},i.prototype.isEmpty=function(){return this.type==CELL_TYPE.EMPTY},i.prototype.setEmpty=function(){this.type=CELL_TYPE.EMPTY},i.prototype.setXY=function(t,e){this.x=t,this.y=e},i.prototype.setStartXY=function(t,e){this.startX=t,this.startY=e},i.prototype.setStatus=function(t){this.status=t},i.prototype.moveToAndBack=function(t){var e=cc.p(this.x,this.y);this.cmd.push({action:"moveTo",keepTime:ANITIME.TOUCH_MOVE,playTime:0,pos:t}),this.cmd.push({action:"moveTo",keepTime:ANITIME.TOUCH_MOVE,playTime:ANITIME.TOUCH_MOVE,pos:e})},i.prototype.moveTo=function(t,e){cc.p(this.x,this.y);this.cmd.push({action:"moveTo",keepTime:ANITIME.TOUCH_MOVE,playTime:e,pos:t}),this.x=t.x,this.y=t.y},i.prototype.toDie=function(t){this.cmd.push({action:"toDie",playTime:t,keepTime:ANITIME.DIE}),this.isDeath=!0},i.prototype.toShake=function(t){this.cmd.push({action:"toShake",playTime:t,keepTime:ANITIME.DIE_SHAKE})},i.prototype.setVisible=function(t,e){this.cmd.push({action:"setVisible",playTime:t,keepTime:0,isVisible:e})},i.prototype.moveToAndDie=function(t){},i.prototype.isBird=function(){return this.type==CELL_TYPE.G},t.CellModel=i,cc._RFpop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],CellView:[function(t,e,i){"use strict";cc._RFpush(e,"fbf19Cx4ptFV62UZ7+qJJpQ","CellView"),cc.Class({"extends":cc.Component,properties:{defaultFrame:{"default":null,type:cc.SpriteFrame}},onLoad:function(){this.isSelect=!1},initWithModel:function(t){this.model=t;var e=t.startX,i=t.startY;this.node.x=CELL_WIDTH*(e-.5),this.node.y=CELL_HEIGHT*(i-.5);var s=this.node.getComponent(cc.Animation);t.status==CELL_STATUS.COMMON?s.stop():s.play(t.status)},updateView:function(){var t=this,e=this.model.cmd;if(!(e.length<=0)){var i=[],s=0;for(var o in e){if(e[o].playTime>s){var c=cc.delayTime(e[o].playTime-s);i.push(c)}if("moveTo"==e[o].action){var l=(e[o].pos.x-.5)*CELL_WIDTH,n=(e[o].pos.y-.5)*CELL_HEIGHT,h=cc.moveTo(ANITIME.TOUCH_MOVE,cc.p(l,n));i.push(h)}else if("toDie"==e[o].action){if(this.status==CELL_STATUS.BIRD){var r=this.node.getComponent(cc.Animation);r.play("effect"),i.push(cc.delayTime(ANITIME.BOMB_BIRD_DELAY))}var a=cc.callFunc(function(){this.node.destroy()},this);i.push(a)}else if("setVisible"==e[o].action)!function(){var s=e[o].isVisible;i.push(cc.callFunc(function(){s?this.node.opacity=255:this.node.opacity=0},t))}();else if("toShake"==e[o].action){var u=cc.rotateBy(.4,60);i.push(u)}s=e[o].playTime+e[o].keepTime}this.node.runAction(cc.sequence(i))}},setSelect:function(t){var e=this.node.getComponent(cc.Animation),i=this.node.getChildByName("select");0==t&&this.isSelect&&this.model.status==CELL_STATUS.COMMON?(e.stop(),this.node.getComponent(cc.Sprite).spriteFrame=this.defaultFrame):t&&this.model.status==CELL_STATUS.COMMON?e.play(CELL_STATUS.CLICK):t&&this.model.status==CELL_STATUS.BIRD&&e.play(CELL_STATUS.CLICK),i.active=t,this.isSelect=t}}),cc._RFpop()},{}],ConstValue:[function(t,e,i){(function(t){"use strict";cc._RFpush(e,"f9088esGbNBtJmNaJsz0Gq4","ConstValue"),t.CELL_TYPE={EMPTY:0,A:1,B:2,C:3,D:4,E:5,F:6,BIRD:7},t.CELL_BASENUM=6,t.CELL_STATUS={COMMON:0,CLICK:"click",LINE:"line",COLUMN:"column",WRAP:"wrap",BIRD:"bird"},t.GRID_WIDTH=9,t.GRID_HEIGHT=9,t.CELL_WIDTH=70,t.CELL_HEIGHT=70,t.GRID_PIXEL_WIDTH=GRID_WIDTH*CELL_WIDTH,t.GRID_PIXEL_HEIGHT=GRID_HEIGHT*CELL_HEIGHT,t.ANITIME={TOUCH_MOVE:.3,DIE:.2,DOWN:.5,BOMB_DELAY:.3,BOMB_BIRD_DELAY:.7,DIE_SHAKE:.4},t.isInArray=function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},t.mergeArray=function(t,e){var i=t.concat();return e.forEach(function(t){i.indexOf(t)==-1&&i.push(t)},this),e.forEach(function(t){i.indexOf(t)==-1&&i.push(t)},this),i},cc._RFpop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],EffectLayer:[function(t,e,i){"use strict";cc._RFpush(e,"0e925myn0dIjqdao1TpipF9","EffectLayer"),cc.Class({"extends":cc.Component,properties:{bombWhite:{"default":null,type:cc.Prefab},crushEffect:{"default":null,type:cc.Prefab}},onLoad:function(){},playEffects:function(t){!t||t.length<=0||t.forEach(function(t){var e=cc.delayTime(t.playTime),i=cc.callFunc(function(){var e=null,i=null;"crush"==t.action?(e=cc.instantiate(this.crushEffect),i=e.getComponent(cc.Animation),i.play("effect")):"rowBomb"==t.action?(e=cc.instantiate(this.bombWhite),i=e.getComponent(cc.Animation),i.play("effect_line")):"colBomb"==t.action&&(e=cc.instantiate(this.bombWhite),i=e.getComponent(cc.Animation),i.play("effect_col")),e.x=CELL_WIDTH*(t.pos.x-.5),e.y=CELL_WIDTH*(t.pos.y-.5),e.parent=this.node,i.on("finished",function(){e.destroy()},this)},this);this.node.runAction(cc.sequence(e,i))},this)}}),cc._RFpop()},{}],GameController:[function(t,e,i){"use strict";cc._RFpush(e,"5ac64Iq16lBqrHZ0246FRcZ","GameController"),cc.Class({"extends":cc.Component,properties:{grid:{"default":null,type:cc.Node}},onLoad:function(){this.gameModel=new GameModel,this.gameModel.init(5);var t=this.grid.getComponent("GridView");t.setController(this),t.initWithCellModels(this.gameModel.getCells())},selectCell:function(t){return this.gameModel.selectCell(t)},cleanCmd:function(){this.gameModel.cleanCmd()}}),cc._RFpop()},{}],GameModelTest:[function(t,e,i){"use strict";cc._RFpush(e,"16fce9lOkpA7a2vuhmMkDMZ","GameModelTest"),cc.Class({"extends":cc.Component,properties:{}}),cc._RFpop()},{}],GameModel:[function(t,e,i){(function(t){"use strict";function i(){this.cells=null,this.cellBgs=null,this.lastPos=cc.p(-1,-1),this.cellTypeNum=5,this.cellCreateType=[]}cc._RFpush(e,"cc442HaMlBE/ZKi7W/YUKwd","GameModel"),i.prototype.init=function(t){this.cells=[],this.setCellTypeNum(t||this.cellTypeNum);for(var e=1;e<=GRID_WIDTH;e++){this.cells[e]=[];for(var i=1;i<=GRID_HEIGHT;i++)this.cells[e][i]=new CellModel}for(var e=1;e<=GRID_WIDTH;e++)for(var i=1;i<=GRID_HEIGHT;i++)for(var s=!0;s;){s=!1,this.cells[e][i].init(this.getRandomCellType());var o=this.checkPoint(i,e)[0];o.length>2&&(s=!0),this.cells[e][i].setXY(i,e),this.cells[e][i].setStartXY(i,e)}},i.prototype.initWithData=function(t){},i.prototype.checkPoint=function(t,e){var i=this,s=function(t,e,i){var s=[],o=[];o[t+9*e]=!0,s.push(cc.p(t,e));for(var c=0;c<s.length;){var l=s[c],n=this.cells[l.y][l.x];if(c++,n)for(var h=0;h<i.length;h++){var r=l.x+i[h].x,a=l.y+i[h].y;r<1||r>9||a<1||a>9||o[r+9*a]||!this.cells[a][r]||n.type==this.cells[a][r].type&&(o[r+9*a]=!0,s.push(cc.p(r,a)))}}return s},o=s.call(this,t,e,[cc.p(1,0),cc.p(-1,0)]),c=s.call(this,t,e,[cc.p(0,-1),cc.p(0,1)]),l=[],n="";return o.length>=5||c.length>=5?n=CELL_STATUS.BIRD:o.length>=3&&c.length>=3?n=CELL_STATUS.WRAP:o.length>=4?n=CELL_STATUS.LINE:c.length>=4&&(n=CELL_STATUS.COLUMN),o.length>=3&&(l=o),c.length>=3&&!function(){var t=l.concat();c.forEach(function(e){var i=!1;t.forEach(function(t){e.x==t.x&&e.y==t.y&&(i=!0)},this),i||l.push(e)},i)}(),[l,n,this.cells[e][t].type]},i.prototype.printInfo=function(){for(var t=1;t<=9;t++){for(var e="",i=1;i<=9;i++)e+=this.cells[t][i].type+" ";console.log(e)}},i.prototype.getCells=function(){return this.cells},i.prototype.selectCell=function(t){this.changeModels=[],this.effectsQueue=[];var e=this.lastPos,i=Math.abs(t.x-e.x)+Math.abs(t.y-e.y);if(1!=i)return this.lastPos=t,[[],[]];this.exchangeCell(e,t);var s=this.checkPoint(t.x,t.y)[0],o=this.checkPoint(e.x,e.y)[0];this.curTime=0,this.pushToChangeModels(this.cells[t.y][t.x]),this.pushToChangeModels(this.cells[e.y][e.x]);var c=this.cells[t.y][t.x].status!=CELL_STATUS.COMMON&&this.cells[e.y][e.x].status!=CELL_STATUS.COMMON||this.cells[t.y][t.x].status==CELL_STATUS.BIRD||this.cells[e.y][e.x].status==CELL_STATUS.BIRD;if(s.length<3&&o.length<3&&!c)return this.exchangeCell(e,t),this.cells[t.y][t.x].moveToAndBack(e),this.cells[e.y][e.x].moveToAndBack(t),this.lastPos=cc.p(-1,-1),[this.changeModels];this.lastPos=cc.p(-1,-1),this.cells[t.y][t.x].moveTo(t,this.curTime),this.cells[e.y][e.x].moveTo(e,this.curTime);var l=[t,e];return this.curTime+=ANITIME.TOUCH_MOVE,this.processCrush(l),[this.changeModels,this.effectsQueue]},i.prototype.processCrush=function(t){for(var e=0;t.length>0;){var i=[];if(0==e&&2==t.length){var s=t[0],o=t[1],c=this.cells[s.y][s.x],l=this.cells[o.y][o.x];if(c.status==CELL_STATUS.BIRD||l.status==CELL_STATUS.BIRD){c.status==CELL_STATUS.BIRD?(c.type=l.type,i.push(c)):(l.type=c.type,i.push(l))}}for(var n in t){var h=t[n];if(this.cells[h.y][h.x]){var r=this.checkPoint(h.x,h.y),a=r[0],u=r[1],p=r[2];if(!(a.length<3)){for(var f in a){var T=this.cells[a[f].y][a[f].x];this.crushCell(a[f].x,a[f].y),T.status!=CELL_STATUS.COMMON&&i.push(T)}this.createNewCell(h,u,p)}}}this.processBomb(i),this.curTime+=ANITIME.DIE,t=this.down(),e++}},i.prototype.createNewCell=function(t,e,i){if(""!=e){e==CELL_STATUS.BIRD&&(i=CELL_TYPE.BIRD);var s=new CellModel;this.cells[t.y][t.x]=s,s.init(i),s.setStartXY(t.x,t.y),s.setXY(t.x,t.y),s.setStatus(e),s.setVisible(0,!1),s.setVisible(this.curTime,!0),this.changeModels.push(s)}},i.prototype.down=function(){for(var t=[],e=1;e<=GRID_WIDTH;e++)for(var i=1;i<=GRID_HEIGHT;i++)if(null==this.cells[e][i]){for(var s=e,o=s;o<=GRID_HEIGHT;o++)this.cells[o][i]&&(this.pushToChangeModels(this.cells[o][i]),t.push(this.cells[o][i]),this.cells[s][i]=this.cells[o][i],this.cells[o][i]=null,this.cells[s][i].setXY(i,s),this.cells[s][i].moveTo(cc.p(i,s),this.curTime),s++);for(var c=1,o=s;o<=GRID_HEIGHT;o++)this.cells[o][i]=new CellModel,this.cells[o][i].init(this.getRandomCellType()),this.cells[o][i].setStartXY(i,c+GRID_HEIGHT),this.cells[o][i].setXY(i,c+GRID_HEIGHT),this.cells[o][i].moveTo(cc.p(i,o),this.curTime),c++,this.changeModels.push(this.cells[o][i]),t.push(this.cells[o][i])}return this.curTime+=ANITIME.TOUCH_MOVE+.3,t},i.prototype.pushToChangeModels=function(t){isInArray(this.changeModels,t)||this.changeModels.push(t)},i.prototype.cleanCmd=function(){for(var t=1;t<=GRID_WIDTH;t++)for(var e=1;e<=GRID_HEIGHT;e++)this.cells[t][e]&&(this.cells[t][e].cmd=[])},i.prototype.exchangeCell=function(t,e){var i=this.cells[t.y][t.x];this.cells[t.y][t.x]=this.cells[e.y][e.x],this.cells[t.y][t.x].x=t.x,this.cells[t.y][t.x].y=t.y,this.cells[e.y][e.x]=i,this.cells[e.y][e.x].x=e.x,this.cells[e.y][e.x].y=e.y},i.prototype.setCellTypeNum=function(t){this.cellTypeNum=t,this.cellCreateType=[];for(var e=1;e<=t;e++)for(;;){var i=Math.floor(Math.random()*CELL_BASENUM)+1;if(this.cellCreateType.indexOf(i)==-1){this.cellCreateType.push(i);break}}},i.prototype.getRandomCellType=function(){var t=Math.floor(Math.random()*this.cellTypeNum);return this.cellCreateType[t]},i.prototype.processBomb=function(t){for(var e=this,i=function(){var i=[],s=ANITIME.BOMB_DELAY;t.forEach(function(t){if(t.status==CELL_STATUS.LINE){for(var e=1;e<=GRID_WIDTH;e++)this.cells[t.y][e]&&(this.cells[t.y][e].status!=CELL_STATUS.COMMON&&i.push(this.cells[t.y][e]),this.crushCell(e,t.y));this.addRowBomb(this.curTime,cc.p(t.x,t.y))}else if(t.status==CELL_STATUS.COLUMN){for(var e=1;e<=GRID_HEIGHT;e++)this.cells[e][t.x]&&(this.cells[e][t.x].status!=CELL_STATUS.COMMON&&i.push(this.cells[e][t.x]),this.crushCell(t.x,e));this.addColBomb(this.curTime,cc.p(t.x,t.y))}else if(t.status==CELL_STATUS.WRAP)for(var o=t.x,c=t.y,e=1;e<=GRID_HEIGHT;e++)for(var l=1;l<=GRID_WIDTH;l++){var n=Math.abs(o-l)+Math.abs(c-e);this.cells[e][l]&&n<=2&&(this.cells[e][l].status!=CELL_STATUS.COMMON&&i.push(this.cells[e][l]),this.crushCell(l,e))}else if(t.status==CELL_STATUS.BIRD){var h=t.type;s<ANITIME.BOMB_BIRD_DELAY&&(s=ANITIME.BOMB_BIRD_DELAY),h==CELL_TYPE.BIRD&&(h=this.getRandomCellType());for(var e=1;e<=GRID_HEIGHT;e++)for(var l=1;l<=GRID_WIDTH;l++)this.cells[e][l]&&this.cells[e][l].type==h&&(this.cells[e][l].status!=CELL_STATUS.COMMON&&i.push(this.cells[e][l]),this.crushCell(l,e,!0))}},e),t.length>0&&(e.curTime+=s),t=i};t.length>0;)i()},i.prototype.addCrushEffect=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"crush"})},i.prototype.addRowBomb=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"rowBomb"})},i.prototype.addColBomb=function(t,e){this.effectsQueue.push({playTime:t,pos:e,action:"colBomb"})},i.prototype.addWrapBomb=function(t,e){},i.prototype.crushCell=function(t,e,i){var s=this.cells[e][t];this.pushToChangeModels(s),i?(s.toShake(this.curTime),s.toDie(this.curTime+ANITIME.DIE_SHAKE)):s.toDie(this.curTime),this.addCrushEffect(this.curTime,cc.p(s.x,s.y)),this.cells[e][t]=null},t.GameModel=i,cc._RFpop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],GridView:[function(t,e,i){"use strict";cc._RFpush(e,"d0d1fDj9rlDx5QUtP+2toQV","GridView"),cc.Class({"extends":cc.Component,properties:{aniPre:{"default":[],type:[cc.Prefab]},effectLayer:{"default":null,type:cc.Node}},onLoad:function(){this.setListener(),this.lastTouchPos=cc.Vec2(-1,-1),this.isCanMove=!0,this.isInPlayAni=!1},setController:function(t){this.controller=t},initWithCellModels:function(t){this.cellViews=[];for(var e=1;e<=9;e++){this.cellViews[e]=[];for(var i=1;i<=9;i++){var s=t[e][i].type,o=cc.instantiate(this.aniPre[s]);o.parent=this.node;var c=o.getComponent("CellView");c.initWithModel(t[e][i]),this.cellViews[e][i]=o}}},setListener:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(this.isInPlayAni)return!0;var e=t.getLocation(),i=this.convertTouchPosToCell(e);if(i){var s=this.selectCell(i);s.length>=3?this.isCanMove=!1:this.isCanMove=!0}else this.isCanMove=!1;return!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){if(this.isCanMove){var e=t.getStartLocation(),i=this.convertTouchPosToCell(e),s=t.getLocation(),o=this.convertTouchPosToCell(s);if(i.x!=o.x||i.y!=o.y){this.isCanMove=!1;this.selectCell(o)}}},this),this.node.on(cc.Node.EventType.TOUCH_END,function(t){},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){},this)},convertTouchPosToCell:function(t){if(t=this.node.convertToNodeSpace(t),t.x<0||t.x>=GRID_PIXEL_WIDTH||t.y<0||t.y>=GRID_PIXEL_HEIGHT)return!1;var e=Math.floor(t.x/CELL_WIDTH)+1,i=Math.floor(t.y/CELL_HEIGHT)+1;return cc.p(e,i)},updateView:function(t){var e=[];for(var i in t){var s=t[i],o=this.findViewByModel(s),c=null;if(o)c=o.view,this.cellViews[o.y][o.x]=null;else{var l=s.type,n=cc.instantiate(this.aniPre[l]);n.parent=this.node;var h=n.getComponent("CellView");h.initWithModel(s),c=n}var r=c.getComponent("CellView");r.updateView(),s.isDeath||e.push({model:s,view:c})}e.forEach(function(t){var e=t.model;this.cellViews[e.y][e.x]=t.view},this)},updateSelect:function(t){for(var e=1;e<=9;e++)for(var i=1;i<=9;i++)if(this.cellViews[e][i]){var s=this.cellViews[e][i].getComponent("CellView");t.x==i&&t.y==e?s.setSelect(!0):s.setSelect(!1)}},findViewByModel:function(t){for(var e=1;e<=9;e++)for(var i=1;i<=9;i++)if(this.cellViews[e][i]&&this.cellViews[e][i].getComponent("CellView").model==t)return{view:this.cellViews[e][i],x:i,y:e};return null},getPlayAniTime:function(t){if(!t)return 0;var e=0;return t.forEach(function(t){t.cmd.forEach(function(t){e<t.playTime+t.keepTime&&(e=t.playTime+t.keepTime)},this)},this),e},disableTouch:function(t){t<=0||(this.isInPlayAni=!0,this.node.runAction(cc.sequence(cc.delayTime(t),cc.callFunc(function(){this.isInPlayAni=!1},this))))},selectCell:function(t){var e=this.controller.selectCell(t),i=e[0],s=e[1];return this.playEffect(s),this.disableTouch(this.getPlayAniTime(i)),this.updateView(i),this.controller.cleanCmd(),i.length>=2?this.updateSelect(cc.p(-1,-1)):this.updateSelect(t),i},playEffect:function(t){this.effectLayer.getComponent("EffectLayer").playEffects(t)}}),cc._RFpop()},{}]},{},["GameController","CellModel","ConstValue","GameModel","CCMath","GameModelTest","CellView","EffectLayer","GridView"]);